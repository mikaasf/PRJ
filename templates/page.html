{% extends 'base.html' %}

{% block head %}

<title>Video - Recording</title>
  <script type="text/javascript">

    let counter = 0;
    let socket;
    let isRecording = false;
    let emotionTimer = 0;

         $(document).ready(function() {

           // sending a connect request to the server.
           socket = io();
           socket.on('connect', function (){
             socket.emit('my event', {data:"I'm connected"});
           });



           // An event handler for a change of value
           $('input.ann').on('keydown', function (event) {
               if (event.key === 'Enter') {
                 if(isRecording) {

                 socket.emit('customInput', {
                   type: $(this).attr('id'),
                   data: $(this).val(),
                   frameID: counter

                 });
               } else {
                  alert("You must start recording first");
                 }
               document.querySelector("#custom").innerHTML = "";
             }

           });

           // An event handler for a change of value
           $('button.stop').on('click', function (event) {
             socket.emit('stop_recording', {
               title: $('input#vid_title').val()
             });
           });

         });

         window.onbeforeunload = function () {
           socket.emit('leaveRecording');
         }
      </script>
{% endblock %}


{% block body %}
  <!-- 16:9 aspect ratio
<div class="embed-responsive embed-responsive-16by9">
  //<iframe class="embed-responsive-item"></iframe>iframe
  <video>

  </video>
</div> -->

  <section>
    <section id="video_controls" style="float: left; margin: 0 1.5%; width: 63%;">
      <h3><input type="text" name="vid_title" placeholder="Video Title" style="background-color: white; border: none;"></h3>
      <span>
          <button id="rec" class="notRec rec-button" disabled></button>
          <button id="changeRec" class="btn-outline-danger" type="submit" onclick="startRecording()">Start Recording</button>
        </span>
      <br/>
      <div class="col-9">
        <img id="videoElement" src="{{ url_for('video') }}" width="130%">
      </div>
      &nbsp;&nbsp;&nbsp; &nbsp;
      {% include 'annotations.html' %}
  </section>
  </section>
<script type="text/javascript">
  function startRecording() {
    if(document.getElementById("changeRec").innerHTML === "Stop &amp; save recording"){
      isRecording = false;
      let form = document.createElement("form");
      form.setAttribute("method", "post");
      let container = document.getElementById("video_controls");
      let elements = [container.childElementCount];
      let j = 0;
      while(container.hasChildNodes()){
        elements[j] = (container.removeChild(container.lastChild));
        j++;
      }
      for (let i = 0; i<elements.length; i++){
        form.appendChild(elements[i]);
        console.log(elements[i]);
      }
      document.getElementById("video_controls").appendChild(form);
      return;
    }

    isRecording = true;
    let rec_light = document.getElementById("rec");
    rec_light.classList.toggle("Rec");
    let rec_button = document.getElementById("changeRec");
    rec_button.classList.toggle("btn-danger");
    document.getElementById("changeRec").innerHTML = "Stop & save recording";
  }
</script>

{% endblock %}